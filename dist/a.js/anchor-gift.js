define(function(t,i,e){var n=t("cons"),s=t("./anchor-swf"),a=t("./anchor-tools");e.exports={oWidth:0,init:function(){function t(){i--,$(".gift-tip-detail .gp22 i").text(i),a.setCookie("fi_time",i,86400),i<=0&&(i=300,e<50&&e++,a.setCookie("fi_num",e,86400),$(".first-nus").text(e),UIF.handler.countingStar({},function(t){})),e>49&&(clearInterval(l),$(".gp22").text("今日星星已达上限"))}if($("#sendGiftBtn").click(function(){if(!UIF.handler.login)return void UIF.handler.loging();var t=parseInt($("#sendGiftNum").val());if(""==t&&(t=0),0==UIF.handler.newSendGiftID)return void a.dialog("请选择礼物");if(t<=0||!$.isNumeric(t))return void a.dialog("请正确填写礼物数量");var i=UIF.handler.cache.get(n.GIFT_TIMEGIFTIDS),e=UIF.handler.cache.get(n.GIFT_TIMEUUIDS),s=UIF.handler.cache.get(n.GIFT_TRANSTIME),r=UIF.handler.cache.get(n.GIFT_TIMEGNUMBERS),l=UIF.handler.cache.get(n.GIFT_TIMENUMBERS);if(null!=i&&null!=e&&null!=s&&null!=l&&null!=r&&i==UIF.handler.newSendGiftID&&r==t){var f=(new Date).getTime(),d=f-s;d<=5e3?(l++,1==l&&l++,s=(new Date).getTime()):(l=0,e=a.uuid(),s=(new Date).getTime())}else l=0,r=t,e=a.uuid(),i=UIF.handler.newSendGiftID,s=(new Date).getTime();UIF.handler.cache.put(n.GIFT_TIMEUUIDS,e),UIF.handler.cache.put(n.GIFT_TRANSTIME,s),UIF.handler.cache.put(n.GIFT_TIMEGIFTIDS,i),UIF.handler.cache.put(n.GIFT_TIMEGNUMBERS,r),UIF.handler.cache.put(n.GIFT_TIMENUMBERS,l),UIF.handler.deduction({uid:e,sendNum:l,giftId:UIF.handler.newSendGiftID,number:t},function(t){var i=jQuery.parseJSON(t);if(100==i.resultStatus){var e='<div class="less-money">                            <div class="less-box">                        <div class="less-header">温馨提示</div>                        <div class="less-close"></div>                            <div class="hsr"></div>                            <div class="less-text">您的<span>余额</span>不足，无法购买</div>                            <div class="less-butt">                                <div class="less-charge butt"><a href="/pay.php">充值</a></div>                                <div class="less-cancel butt">取消</div>                            </div>                        </div>                        </div>';return $("body").append(e),$(".less-money").css({left:$(".newGifts").offset().left+400,top:$(".newGifts").offset().top-105}),void $(".less-money").show()}a.dialog(i.resultMessage)})}),$(".giveBtn").mousedown(function(){$(this).addClass("down")}),$(".giveBtn").mouseup(function(){$(this).removeClass("down")}),$("body").on("click",".less-close,.less-cancel",function(){$(".less-money").hide()}),$(".giftHeader").on("click",".redot",function(){$.ajax({type:"POST",url:"/ajax/giftClick.php",data:"",dataType:"json",timeout:12e5,success:function(t){1==t&&$(".giftHeader span:last").removeClass("redot")},error:function(t,i,e){}})}),$(".giftLists  li:not(:first)").mouseover(function(){var t;t=$(this).find("div").attr("price")>0?$(this).find("img").attr("rel")+"</i>K豆":"",$(this).find("img").attr("join")>0?$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div>                \t\t<div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i>"+t+'</p><p class="gp2">连送<i>2</i>组<i> '+$(this).find("img").attr("join")+"</i>，触发连击特效</p></div>"):$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div><div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i>"+t+"</p></div>"),null!=$(this).attr("giftnum")&&(p3='<p  class="gp3">数量：'+$(this).attr("giftnum")+"</p>",$(".gift-tip-detail").append(p3)),$(".gift-tip-popup").show()}).mouseout(function(){$(".gift-tip-popup").hide()}).mousemove(function(t){var i=t.pageX,e=t.pageY;$(".gift-tip-popup").css({left:i+40+"px",top:e-120+"px"})}),UIF.handler.login){var i=0,e=0,s=a.getCookie("fi_time"),r=a.getCookie("fi_num");s?i=a.getCookie("fi_time"):(a.setCookie("fi_time",300,86400),i=300),r?e=a.getCookie("fi_num"):(a.setCookie("fi_num",0,86400),e=0),e>=50&&(clearInterval(l),$(".gift-tip-detail .gp22").text("今天获得星星已达上限!"));var l=setInterval(t,1e3);$(".giftLists  li:first").mouseover(function(){$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div>                     \t\t<div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i> "+$(this).find(".first-nus").text()+'</i> 个</p><p class="gp22"><i> '+i+"</i>秒获取下一颗</p></div>"),null!=$(this).attr("giftnum")&&(p3='<p  class="gp3">数量：'+$(this).attr("giftnum")+"</p>",$(".gift-tip-detail").append(p3)),$(".gift-tip-popup").show()}).mouseout(function(){$(".gift-tip-popup").hide()}).mousemove(function(t){var i=t.pageX,e=t.pageY;$(".gift-tip-popup").css({left:i+40+"px",top:e-120+"px"})})}var f=0,d=$(".xGiftList li").length;$(".giftHeader span").click(function(){$("#stdSps").hide(),f=0,$(this).addClass("haselect"),$(this).siblings().removeClass("haselect"),$(".giftLists li").find("div").removeClass("intro"),$(".giftLists ul").removeClass("xGiftList"),$("#giftList"+$(this).attr("rel")).addClass("xGiftList"),UIF.handler.newSendGiftID="",d=$(".xGiftList li").length,this.oWidth=d*(Math.ceil($(".xGiftList  li").width())+6)+5,this.oWidth=this.oWidth<384?384:this.oWidth,$(".xGiftList").css({width:this.oWidth,"margin-left":0})}),$(".visualGiftList").on("mouseover","li div",function(t){var i=$(this).find("img");src=i[0].src,i.attr("src",src)}).on("mousedown","li div",function(t){"0"==$(this).find("img").attr("types")?$("#giftShapeBtns").show():($("#sendGiftNum").val(1),$("#giftShapeBtns").hide()),$(this).addClass("intro"),gridimage=$(this).find("img"),$(this).parent().siblings().find("div").removeAttr("choose").removeClass("intro"),UIF.handler.newSendGiftID=$(this).attr("id").replace("gift","")}).on("mouseout","li div",function(t){var i=$(this).find("img");!i.hasClass("intro")});var o=0,c=0,u=0;this.oWidth=d*(Math.ceil($(".xGiftList  li").width())+8),c=6*($(".xGiftList  li").width()+6),o=Math.ceil(d/6),$(".xGiftList").css({width:this.oWidth}),$(".giftContents").on("click",".toRight",function(){d>6&&!(f-o>=-1)&&(u=parseInt($(".xGiftList").css("marginLeft")),$(".xGiftList").animate({"margin-left":u-c},300),f++)}),$(".giftContents").on("click",".toLeft",function(){f<1||(u=parseInt($(".xGiftList").css("marginLeft")),$(".xGiftList").animate({"margin-left":u+c},300),f--)})},filGift:function(t){s.fil({giftId:t.giftId,number:t.number,car:0})},figGift:function(t){var i="",e="A";if(void 0!=t.par&&""!=t.par){var n=JSON.parse(t.par);e=n[t.number]}var a=t.giftId;switch(e){case"A":i="giftShape_"+t.number,a+=".png";break;case"B":i="giftShape_"+t.number+"_3d",a+=".png";break;case"C":i="giftShape_"+t.number+"_puzzle",a="big"+a+".swf"}s.fig({image:a,shape:i})},customGift:function(t){s.cus({image:t.giftId,number:t.number})},sendGift:function(t){var i=[10,66,99,188,520,1314];switch($.inArray(t.number,i)==-1&&0==t.giftType&&(t.giftType="-1"),t.giftType){case"1":this.filGift(t);break;case"0":this.figGift(t);break;case"-1":this.customGift(t)}if(null!=t&&null!=t.par&&""!=t.par){var e=JSON.parse(t.par);null!=e&&null!=e.join&&t.number>=e.join&&this.multyGift(t)}},multyGift:function(t){t.sendNum>0&&s.mul({uid:t.uid,user:decodeURI(t.user),number:t.number,sendNum:t.sendNum,headImg:UIF.cdn_img+"/"+t.avatar,giftImg:t.giftId})},actGift:function(t){s.act({headImg:UIF.cdn_img+"/"+t.himage,actlevel:t.actlev})},cohGift:function(t){s.coh({headImg:UIF.cdn_img+"/"+t.himage,cohlevel:t.cohlevel,anhimg:UIF.cdn_img+"/"+t.anhimg})},speGift:function(t){s.spe({nickname:decodeURI(t.nickname),speimg:"/static_data/images_css/upgrades/pic_consumelevel_"+t.splev+".png"})},enterCar:function(t){if(null!=t.enterCar){var i=jQuery.parseJSON(t.enterCar),e="";e=void 0==i.carName||""==i.carName?"豪车":i.carName;var n="1";if(null!=i.par&&""!=i.par){var a=JSON.parse(i.par);"1"==a.flag&&(n="0")}t.nickname==UIF.currentUserNickname?setTimeout(function(){s.fil({giftId:i.giftId,number:i.number,car:1,nickname:decodeURI(t.nickname),carName:e,needAddFlag:n})},3e3):s.fil({giftId:i.giftId,number:i.number,car:1,nickname:decodeURI(t.nickname),carName:e,needAddFlag:n})}},interval:!1,giftQueue:new Array,sendRecord:function(t){function i(){var t=e.giftQueue[0];e.giftQueue.splice(0,1),$("#movelist1").append(t);try{$("#nano-sendGiftList").nanoScroller(),$("#nano-sendGiftList").nanoScroller({scroll:"bottom"})}catch(t){UIF.handler.weblog(t)}var i=$("#movelist1 li").length;i>50&&$("#movelist1 li:lt("+(i-50)+")").remove(),0==e.giftQueue.length&&(clearInterval(g),e.interval=!1)}if(null==t||void 0==t||""==t)return!1;t.ctime=a.dateFormat(new Date,"HH:mm");var e=this,n='<span class="gr-ulevel {0}"></span>',s=UIF.cdn_img+"/"+t.samllimg+"?p=0",r='<li>\t\t\t\t\t\t<div>\t\t\t\t\t\t<span class="gr-time">'+a.dateFormat(new Date,"HH:mm")+'</span>{0}\t\t\t\t\t\t<span class="gr-sender">{1}</span>\t\t\t\t\t\t<span class="gr-song">送</span>{2}\t\t\t\t\t\t<img src="{3}" />\t\t\t\t\t\t<span class="color-green">{4}</span>\t\t\t\t\t\t</div>\t\t\t\t\t\t</li>';if(null!=t&&""!=t.number&&t.number>0){for(var l=new Array,f=0;f<t.number;f++)l.push(f);if(t.number>300){var d=new Array;d=l.slice(0,150);for(var f=t.number-150;f<t.number;f++)d.push(f);l=d}var o="";$n="",$h="";for(var c=0;c<l.length;c++){o=a.stringFormat(s,t.giftId),$n=1==t.number?"":"X"+(l[c]+1);var u="";$touser="",null!=t.spender&&""!=t.spender&&t.spender.indexOf("pic_consumelevel_0")<0&&(u+=a.stringFormat(n,t.spender)),null!=t.guards&&""!=t.guards&&(u+=a.stringFormat(n,t.guards)),null!=t.toUserName&&""!=t.toUserName&&($touser+=t.toUserName),$h=a.stringFormat(r,u,decodeURI(t.user),decodeURI($touser),o,$n),e.giftQueue.push($h)}var g;e.interval||(g=setInterval(i,50),e.interval=!0)}}}});