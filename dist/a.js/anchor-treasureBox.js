define(function(require,exports,module){var swf=require("./anchor-swf"),Tools=require("./anchor-tools"),UserData=require("./anchor-user");module.exports={Cannotopen_State:"cannotopen_state",Couldopen_State:"couldopen_state",Open_Animation:"open_animation",Close_Animation:"close_animation",CONST_MAXCOUNT:3,CONST_GAPARRAY:[5,15,30],CONST_REACHMAX:"今日宝箱已经领取完毕",CONST_TIMELIMIT:" 宝箱冷却中",CONST_LEFTTIME:"剩余{0}",CONST_COULDLINGQU:"点击领取",CONST_GIFTNUM:"x{0}",current_count:0,timetick:0,timetick_timeout:0,Switch:!1,socketAfter:function(){var e=this;this.Switch&&UIF.handler.sendTreasureBoxInit(null,function(t){e.initTreasureBoxData(t)})},init:function(options){if(UIF.roomType){var param=jQuery.parseJSON(options.params);param.hasOwnProperty(UIF.roomType)&&(this.Switch=eval(param[UIF.roomType].boxs))}this.initView(),this.initInteractions()},initView:function(){$("#treasureBox_div").hide(),$("#treasureBox_reward_div").hide()},initInteractions:function(){var e=this;$("#treasureBox_clickRect").click(function(t){e.openTreasureBox()}),$("#treasureBox_reward_confirm").click(function(t){e.showCloseMovie(),e.startTimeTick(),e.hideTreasureBox_reward()})},initTreasureBoxData:function(e){return this.current_count=parseInt(e.boxNum),this.checkIfReachMax()?void this.hideTreasureBox():(this.showTreasureBox(),void this.startTimeTick())},showTreasureBox:function(){$("#treasureBox_div").show()},hideTreasureBox:function(){$("#treasureBox_div").hide()},startTimeTick:function(){if(this.checkIfReachMax())return void this.hideTreasureBox();if(!(this.current_count>=this.CONST_GAPARRAY.length)){this.setBoxToTimeTickState(),this.timetick=this.CONST_GAPARRAY[this.current_count];var e=this,t=function(){return e.timetick--,e.updateBoxStateShow(),e.timetick<=0?(e.timetick=0,e.stopTimeTick(),void e.setBoxToReadyOpenState()):void(this.timetick_timeout=setTimeout(t,1e3))};t()}},stopTimeTick:function(){clearTimeout(this.timetick_timeout)},setBoxToReadyOpenState:function(){this.showState(this.Couldopen_State)},setBoxToTimeTickState:function(){this.showState(this.Cannotopen_State)},showOpenMovie:function(){this.showState(this.Open_Animation)},showCloseMovie:function(){this.showState(this.Close_Animation)},showState:function(e){var t=function(){swf.changeTreasureBoxState(e)};try{t()}catch(e){setTimeout(t,1e3)}},updateBoxStateShow:function(){this.timetick>0?$("#treasureBox_text").html(this.CONST_LEFTTIME.replace("{0}",this.convertToMS(this.timetick))):$("#treasureBox_text").html(this.CONST_COULDLINGQU)},convertToMS:function(e){var t="",i=Math.floor(e/60),r=e%60;return t+=i>=10?i:"0"+i,t+=":",t+=r>=10?r:"0"+r},openTreasureBox:function(){if(!UIF.handler.login)return void UIF.handler.loging();if(this.checkIfReachMax())return void Tools.dialog(this.CONST_REACHMAX);if(this.timetick>0)return void Tools.dialog(this.CONST_TIMELIMIT);var e=this,t={count:this.current_count+1};UIF.handler.openTreasureBox(t,function(t){var i=jQuery.parseJSON(t);200==i.resultStatus?(e.current_count=parseInt(i.boxNum),e.updateRewardShow(i),e.showTreasureBox_reward(),e.showOpenMovie()):110==i.resultStatus&&(e.current_count=parseInt(i.boxNum),e.startTimeTick())})},GiftType_Money:0,GiftType_Luxury:1,GiftType_Common:2,FrameUrl_Money:"/images/treasurebox/coins.png",FrameUrl_Luxury:"/images/treasurebox/specialGift.png",FrameUrl_Common:"/images/treasurebox/normalGift.png",updateRewardShow:function(e){$("#treasureBox_reward_name").html(e.giftName),$("#treasureBox_reward_num").html(this.CONST_GIFTNUM.replace("{0}",e.giftNum));var t="";switch(e.giftType){case this.GiftType_Money:t=this.FrameUrl_Money,$("#treasureBox_reward_rewardIcon").css("background-image","url(/images/treasurebox/coin.png?p=0)");break;case this.GiftType_Luxury:t=this.FrameUrl_Luxury,$("#treasureBox_reward_rewardIcon").css("background-image","url("+e.giftPic+"?p=0)");break;case this.GiftType_Common:t=this.FrameUrl_Common,$("#treasureBox_reward_rewardIcon").css("background-image","url("+e.giftPic+"?p=0)")}$("#treasureBox_reward_frame").css("background-image","url("+t+"?p=0)")},checkIfReachMax:function(){return this.current_count>=this.CONST_MAXCOUNT},showTreasureBox_reward:function(){$("#treasureBox_reward_div").show(),$("#shadow").show()},hideTreasureBox_reward:function(){$("#treasureBox_reward_div").hide(),$("#shadow").hide()}}});