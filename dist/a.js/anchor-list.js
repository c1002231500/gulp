define(function(e,t,n){var a=(e("cons"),e("map")),s=e("./anchor-tools");n.exports={page:0,init:function(e){var t=this;$(".aud").click(function(){t.page=0,$(".audience").css({opacity:0,display:"block"}).animate({left:70,opacity:1},500,"swing",function(e){$(this).addClass("bg-show"),t.flushUsers()})}),$(".nexp").on("click",function(){t.page++;var e=t.getUserlist(t.page);null!=e&&void 0!=e&&t.addToUsers(e)}),$(".viewer").on("click",function(){return t.page=0,$(this).hasClass("on")?(t.flushUsers(),!1):($(".manager").removeClass("on"),$(this).addClass("on"),$(".viewer-list").show(),$(".manager-list").hide(),void 0)}),$(".manager").on("click",function(){return t.flushManagers(),!$(this).hasClass("on")&&($(".viewer").removeClass("on"),$(this).addClass("on"),$(".manager-list").show(),$(".viewer-list").hide(),void 0)})},welcome:function(e){UIF.handler.weblog(JSON.stringify(e)+"进入")},addUsers:function(e){UIF.handler.userList.containsKey(e.userId)||(UIF.handler.userList.put(e.userId,e),UIF.handler.userList.size()>20?$(".nexp").show():$(".nexp").hide())},getUserlist:function(e){var t=UIF.handler.userList,n=new a,s=20+5*e;if(t.size()<s)return!1;if(t.size()>0)for(var l=s-5;l<s;l++)n.put(t.elements[l].key,t.elements[l].value);return n},addToUsers:function(e){if(null==e||""==e||void 0==e)return!1;var t=this.parseHtml(e);$(".usersList").append(t),$(".viewer-list").nanoScroller(),$(".viewer-list").nanoScroller({scroll:"bottom"})},parseHtml:function(e){if(null==e||""==e||void 0==e)return!1;for(var t=this,n='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t  </li>',a="",l=e.values(),i=0;i<l.length;i++)for(var r=0;r<l.length;r++)if(parseInt(l[i].splev)>parseInt(l[r].splev)){var o=l[i];l[i]=l[r],l[r]=o}return l.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_liverlevel")>0&&(a+=s.stringFormat(n,e.userId,t.headimg(e.levs),decodeURI(e.nickname),decodeURI(e.nickname)))}),l.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_liverlevel")<0&&(a+=s.stringFormat(n,e.userId,t.headimg(e.levs),decodeURI(e.nickname),decodeURI(e.nickname)))}),a},flushUsers:function(){for(var e=this,t='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t  </li>',n="",a=UIF.handler.userList.values(),l=0;l<a.length;l++)for(var i=0;i<a.length;i++)if(parseInt(a[l].splev)>parseInt(a[i].splev)){var r=a[l];a[l]=a[i],a[i]=r}a.forEach(function(a,l){if(l>20)return!1;var i=a.levs;null!=i&&i.indexOf("pic_liverlevel")>0&&(n+=s.stringFormat(t,a.userId,e.headimg(a.levs),decodeURI(a.nickname),decodeURI(a.nickname)))}),a.forEach(function(a,l){if(l>20)return!1;var i=a.levs;null!=i&&i.indexOf("pic_liverlevel")<0&&(n+=s.stringFormat(t,a.userId,e.headimg(a.levs),decodeURI(a.nickname),decodeURI(a.nickname)))}),$(".usersList").html(n),$(".viewer-list").nanoScroller(),$(".viewer-list").nanoScroller({scroll:"bottom"})},flushBuUsers:function(e){var t=this,n='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}" style="font-size: 12px;">{3}</span>\t\t\t\t\t  </li>',a="";null!=e?values=e:values=UIF.handler.userList.values();for(var l=0;l<values.length;l++)for(var i=0;i<values.length;i++)if(parseInt(values[l].splev)>parseInt(values[i].splev)){var r=values[l];values[l]=values[i],values[i]=r}values.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_liverlevel")>0&&UIF.handler.anchorId!=e.userId&&(a+=s.stringFormat(n,e.userId,t.headimg(e.levs),decodeURI(e.nickname),decodeURI(e.nickname)))}),values.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_consumelevel")>0&&l.indexOf("pic_liverlevel")<0&&UIF.handler.anchorId!=e.userId&&(a+=s.stringFormat(n,e.userId,t.headimg(e.levs),decodeURI(e.nickname),decodeURI(e.nickname)))}),$("#song_item").html(a);try{$("#nano-guardList").nanoScroller(),$("#nano-guardList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}},flushManagers:function(){for(var e=this,t='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t<span class=""></span>\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t</li>',n="",a=UIF.handler.userList.values(),l=0;l<a.length;l++)for(var i=0;i<a.length;i++)if(a[l].splev<a[i].splev){var r=a[i];a[i]=a[i],a[i]=r}var o=0;a.forEach(function(a){var l=a.levs;null!=l&&l.indexOf("pic_guanli")>0&&(n+=s.stringFormat(t,a.userId,e.headimg(a.levs),decodeURI(a.nickname),decodeURI(a.nickname)),o+=1)}),$(".managerList").html(n),$(".manager-list").nanoScroller(),$(".manager-list").nanoScroller({scroll:"bottom"}),$(".manager>span").text(o)},headimg:function(e){var t="",n='<span class="{0}"></span>',a=jQuery.parseJSON(e);if(null!=a&&a.length>0)for(var l=0;l<a.length;l++){var i=a[l];null!=i&&""!=i&&(i.indexOf("pic_consumelevel")>0||i.indexOf("pic_activelevel")>0||i.indexOf("pic_relationlevel")>0||i.indexOf("pic_liverlevel")>0||i.indexOf("pic_guanli")>0)&&(t+=s.stringFormat(n,i))}return t}}});