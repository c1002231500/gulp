define(function(e,t,n){var s=(e("cons"),e("map")),a=e("anchor-tools");n.exports={page:0,init:function(e){var t=this;$(".aud").click(function(){t.page=0,$(".audience").css({opacity:0,display:"block"}).animate({left:70,opacity:1},500,"swing",function(e){$(this).addClass("bg-show"),t.flushUsers()})}),$(".nexp").on("click",function(){t.page++;var e=t.getUserlist(t.page);null!=e&&void 0!=e&&t.addToUsers(e)}),$(".viewer").on("click",function(){return t.page=0,$(this).hasClass("on")?(t.flushUsers(),!1):($(".manager").removeClass("on"),$(this).addClass("on"),$(".viewer-list").show(),$(".manager-list").hide(),void 0)}),$(".manager").on("click",function(){return t.flushManagers(),!$(this).hasClass("on")&&($(".viewer").removeClass("on"),$(this).addClass("on"),$(".manager-list").show(),$(".viewer-list").hide(),void 0)})},welcome:function(e){UIF.handler.weblog(JSON.stringify(e)+"进入")},addUsers:function(e){UIF.handler.userList.containsKey(e.userId)||(UIF.handler.userList.put(e.userId,e),UIF.handler.userList.size()>20?$(".nexp").show():$(".nexp").hide())},getUserlist:function(e){var t=UIF.handler.userList,n=new s,a=20+5*e;if(t.size()<a)return!1;if(t.size()>0)for(var l=a-5;l<a;l++)n.put(t.elements[l].key,t.elements[l].value);return n},addToUsers:function(e){if(null==e||""==e||void 0==e)return!1;var t=this.parseHtml(e);$(".usersList").append(t),$(".viewer-list").nanoScroller(),$(".viewer-list").nanoScroller({scroll:"bottom"})},parseHtml:function(e){if(null==e||""==e||void 0==e)return!1;for(var t=this,n='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t  </li>',s="",l=e.values(),r=0;r<l.length;r++)for(var i=0;i<l.length;i++)if(parseInt(l[r].splev)>parseInt(l[i].splev)){var o=l[r];l[r]=l[i],l[i]=o}return l.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_liverlevel")>0&&(s+=a.stringFormat(n,e.userId,t.headimg(e.levs),decodeURIComponent(e.nickname),decodeURIComponent(e.nickname)))}),l.forEach(function(e){var l=e.levs;null!=l&&l.indexOf("pic_liverlevel")<0&&(s+=a.stringFormat(n,e.userId,t.headimg(e.levs),decodeURIComponent(e.nickname),decodeURIComponent(e.nickname)))}),s},flushUsers:function(){for(var e=this,t='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t  </li>',n="",s=UIF.handler.userList.values(),l=0;l<s.length;l++)for(var r=0;r<s.length;r++)if(parseInt(s[l].splev)>parseInt(s[r].splev)){var i=s[l];s[l]=s[r],s[r]=i}s.forEach(function(s,l){if(l>20)return!1;var r=s.levs;null!=r&&r.indexOf("pic_liverlevel")>0&&(n+=a.stringFormat(t,s.userId,e.headimg(s.levs),decodeURIComponent(s.nickname),decodeURIComponent(s.nickname)))}),s.forEach(function(s,l){if(l>20)return!1;var r=s.levs;null!=r&&r.indexOf("pic_liverlevel")<0&&(n+=a.stringFormat(t,s.userId,e.headimg(s.levs),decodeURIComponent(s.nickname),decodeURIComponent(s.nickname)))}),$(".usersList").html(n),$(".viewer-list").nanoScroller(),$(".viewer-list").nanoScroller({scroll:"bottom"})},flushBuUsers:function(e){var t=this,n='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t\t<span class="ICON-noble-level ICON-nl-13"></span>\t\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t\t<span class="name" title="{2}" style="font-size: 12px;">{3}</span>\t\t\t\t\t  </li>',s="";null!=e?values=e:values=UIF.handler.userList.values(),values=a.uniqueArrayKey(values,"userId"),values=values.sort(a.sortBy("levs",1)),values.forEach(function(e,l){null!=e.userId&&e.userId==UIF.handler.anchorId&&(s+=a.stringFormat(n,e.userId,t.headimg(e.levs),decodeURIComponent(e.nickname),decodeURIComponent(e.nickname)))}),values.forEach(function(e,l){null!=e.userId&&e.userId!=UIF.handler.anchorId&&(s+=a.stringFormat(n,e.userId,t.headimg(e.levs),decodeURIComponent(e.nickname),decodeURIComponent(e.nickname)))}),$("#song_item").html(s);try{$("#nano-guardList").nanoScroller()}catch(e){UIF.handler.weblog(e)}},flushManagers:function(){for(var e=this,t='<li data-cardid="{0}" class="anchor">\t\t\t\t\t\t<span class=""></span>\t\t\t\t\t\t<i class="ICON-medal">{1}</i>\t\t\t\t\t\t<span class="name" title="{2}">{3}</span>\t\t\t\t\t</li>',n="",s=UIF.handler.userList.values(),l=0;l<s.length;l++)for(var r=0;r<s.length;r++)if(s[l].splev<s[r].splev){var i=s[r];s[r]=s[r],s[r]=i}var o=0;s.forEach(function(s){var l=s.levs;null!=l&&l.indexOf("pic_guanli")>0&&(n+=a.stringFormat(t,s.userId,e.headimg(s.levs),decodeURIComponent(s.nickname),decodeURIComponent(s.nickname)),o+=1)}),$(".managerList").html(n),$(".manager-list").nanoScroller(),$(".manager-list").nanoScroller({scroll:"bottom"}),$(".manager>span").text(o)},headimg:function(e){var t="",n='<span class="{0}"></span>';try{var s=jQuery.parseJSON(e)}catch(e){var s=""}if(null!=s&&s.length>0)for(var l=0;l<s.length;l++){var r=s[l];null!=r&&""!=r&&(r.indexOf("pic_consumelevel")>0||r.indexOf("pic_activelevel")>0||r.indexOf("pic_relationlevel")>0||r.indexOf("pic_liverlevel")>0||r.indexOf("pic_guanli")>0)&&(t+=a.stringFormat(n,r))}return t}}});