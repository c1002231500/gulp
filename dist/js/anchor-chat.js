define(function(e,a,n){var t=e("cons"),s=e("anchor-tools"),r=e("anchor-face"),i=e("flyScreen"),l=e("toproom");n.exports={init:function(){$("#msgContent").keypress(function(e){13==e.which&&(e.preventDefault(),!$("#sendChatBtn").attr("disabled")&&$("#sendChatBtn").is(":visible")&&$("#sendChatBtn").click())}),$(".msgContent").focus(function(){$(".cf-inputs").css({border:"1px solid #7cbcf4","box-shadow":"1px 1px 1px #bed4e7 inset"})}),$(".msgContent").blur(function(){$(".cf-inputs").css("border","1px solid #c9c7ca")}),$("#sendChatBtn").click(function(){function e(){m--,$("#sendChatNotice").text(" ["+m+"]秒后再试"),$("#sendChatNotice").show(),$("#sendChatBtn").attr("disabled",!0),0==m&&(clearInterval(g),$("#sendChatBtn").attr("disabled",!1),$("#sendChatNotice").hide())}if(!UIF.handler.login)return void UIF.handler.loging();var a=!1,n=$("#msgContent").val();if(""!=n){n.length>50&&s.dialog("您的聊天内容过长，请确保不超过15个汉字!");var r=UIF.handler.cache.get(t.USER_HEADIMAG);switch(UIF.handler.sendTsg){case"ALL":var i,l=UIF.handler.cache.get(t.USER_HEADROLES),o=UIF.handler.cache.get(t.USER_HEADINFOS),c=UIF.handler.cache.get(t.LOCAL_TIMESENDMSG);if(null!=o&&o.anchorId!=UIF.handler.userId&&null!=l&&l.length>0){var d=jQuery.parseJSON(l);s.arrayContains(d,1)||s.arrayContains(d,2)||(i=2e3),s.arrayContains(d,1)&&(i=1e3),s.arrayContains(d,2)&&(i=1e3)}var h=!1;if(null!=c){var u=(new Date).getTime();u-c>=i&&(h=!0,c=(new Date).getTime())}else h=!0,c=(new Date).getTime();if(UIF.handler.cache.put(t.LOCAL_TIMESENDMSG,c),h||UIF.handler.userId==UIF.handler.anchorId)null!=UIF.handler.sendUserId&&UIF.handler.sendUserId.length>0?(UIF.handler.sendChatP2P({nickname:UIF.currentUserNickname,message:n,levs:r,toUser:UIF.handler.sendUserId},function(e){}),UIF.handler.sendUserId=null):UIF.handler.sendChatALL({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){}),a=!0;else var m=3,g=setInterval(e,1e3);break;case"FLY":var p=UIF.handler.cache.get(t.USER_SENDDANMU);p||s.dialog("弹幕200蚪币每条!",function(e){UIF.handler.cache.put(t.USER_SENDDANMU,!0),UIF.handler.sendChatFLY({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){100==e.resultStatus&&s.dialog(e.resultMessage)})},function(e){}),p&&UIF.handler.sendChatFLY({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){100==e.resultStatus&&s.dialog(e.resultMessage)}),a=!0;break;case"GLO":var l=UIF.handler.cache.get(t.USER_HEADROLES);if(null!=l&&l.length>0){var d=jQuery.parseJSON(l);if(s.arrayContains(d,8)){var f=UIF.handler.cache.get(t.USER_SENDNICE);f||s.dialog("全站公告5000蚪币每条!",function(e){UIF.handler.cache.put(t.USER_SENDNICE,!0),UIF.handler.sendChatGLO({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){100==e.resultStatus&&s.dialog(e.resultMessage)})},function(e){}),f&&UIF.handler.sendChatGLO({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){100==e.resultStatus&&s.dialog(e.resultMessage)})}else s.dialog("全站公告需要爵位6级以上!")}a=!0;break;default:var h=!1,l=UIF.handler.cache.get(t.USER_HEADROLES);if(null!=l&&l.length>0){var d=jQuery.parseJSON(l);s.arrayContains(d,12)&&(h=!0,UIF.handler.sendChatPRV({nickname:UIF.currentUserNickname,message:n,levs:r},function(e){}))}h||s.dialog("向主播发送私聊消息,需要爵位达到6级以上!"),a=!0}a&&$("#msgContent").val("")}else try{$("#msgContent").focusInput(),$("#msgContent").focus()}catch(e){}}),$(".sdChat").mousedown(function(){$(this).addClass("sdChatBtnC")}),$(".sdChat").mouseup(function(){$(this).removeClass("sdChatBtnC")});var e=0;$("#pubChatList").on("click","li .u",function(a){var n=$(this).attr("rel"),s=$(this).attr("class");if(void 0!=n){var r=n.split(" ")[0],i=n.split(" ")[1],l=n.split(" ")[2]+" "+n.split(" ")[3],o=(a.pageX,a.pageY),c=$(".chat-area"),d=c[0].offsetLeft;null!=l&&l.indexOf("undefined")==-1?($(".levelss").html("<span class='"+l+"'></span>"),$(".chat-tip-name").css("margin-left","15px"),$(".levelss").show()):($(".levelss").hide(),$(".chat-tip-name").css("margin-left","0px")),$(".chat-tip-id").html("ID："+r),$(".chat-tip-id").attr("tid",r),$(".chat-tip-name").text(i),$(".chat-tip-warp").css({left:d+20,top:o+20+"px"});var h=UIF.handler.cache.get(t.USER_HEADROLES);$(".chat-tip-kick .kick").hide(),$(".chat-tip-atan .atan").hide(),$(".chat-tip-jinyan .jinyan").hide();var u=UIF.handler.cache.get(t.USER_HEADINFOS);$(".chat-tip-img img").attr("src","/apis/avatar.php?uid="+r),null!=u&&UIF.handler.anchorId!=r&&u.userId!=r&&null!=h&&h.length>0&&(h.indexOf("12")>0&&$(".chat-tip-atan .atan").show(),(h.indexOf("13")>0||h.indexOf("14")>0||h.indexOf("15")>0)&&$(".chat-tip-jinyan .jinyan").show(),(h.indexOf("16")>0||h.indexOf("17")>0||h.indexOf("18")>0)&&$(".chat-tip-kick .kick").show(),h.indexOf("18")>0&&h.indexOf("15")>0&&UIF.handler.anchorId==UIF.currentUserID&&($(".setManager,.resetManager").hide(),s.indexOf("gl")<0&&0==e?$(".setManager").show():$(".resetManager").show(),$(".chat-tip-setM").show())),$(".chat-tip-warp").show()}}),$(".setManager").click(function(){var a=$(".toggleBox .chat-tip-id").attr("tid");UIF.handler.roomManagers({toIds:a,drives:"adds"},function(a){a=jQuery.parseJSON(a),null!=a&&"success"==a.resultMessage&&(s.dialog("添加成功！"),$(".resetManager").show(),$(".setManager").hide(),e=1)})}),$(".resetManager").click(function(){var a=$(".toggleBox .chat-tip-id").attr("tid");UIF.handler.roomManagers({toIds:a,drives:"dels"},function(a){a=jQuery.parseJSON(a),null!=a&&"success"==a.resultMessage&&(s.dialog("删除成功！"),$(".resetManager").hide(),$(".setManager").show(),e=0)})}),$(".toggleBox").on("click",".chat-tip-atan .atan",function(e){if(!UIF.handler.login)return void UIF.handler.loging();var a=$(".toggleBox .chat-tip-id").attr("tid"),n=$(".toggleBox .chat-tip-name").text();return a==UIF.handler.userId?void s.dialog("不能自我私聊!"):($("#msgContent").val("@"+n+":"),UIF.handler.sendUserId=a,void $("#msgContent").focus())}),$(".chat-header .closing").click(function(){return UIF.handler.login?void s.dialog("确定关闭此直播间，进行重新审查！",function(e){UIF.handler.censor({},function(e){})},function(e){}):void UIF.handler.loging()}),$(".toggleBox").on("click",".chat-tip-bottom .jinyan",function(e){if(!UIF.handler.login)return void UIF.handler.loging();var a=$(".toggleBox .chat-tip-id").attr("tid");if(a==UIF.handler.userId)return void s.dialog("不能自我禁言!");UIF.handler.blacks({toIds:a,drives:"banned"},function(e){var a=jQuery.parseJSON(e);200==a.resultStatus?s.dialog("禁言成功!"):s.dialog("禁言失败,"+a.resultMessage)});var n={userId:a,roomNumber:UIF.currentRoomNumber};$.ajax({type:"POST",url:"/ajax/delChatMessage.php",data:n,cache:!1,dataType:"json",async:!1}).done(function(e){console.log(e)})}),$(".toggleBox").on("click",".chat-tip-bottom .kick",function(e){if(!UIF.handler.login)return void UIF.handler.loging();var a=$(".toggleBox .chat-tip-id").attr("tid");return a==UIF.handler.userId?void s.dialog("不能自我踢出!"):void UIF.handler.blacks({toIds:a,drives:"kickout"},function(e){var a=jQuery.parseJSON(e);200==a.resultStatus?s.dialog("踢出成功!"):s.dialog("踢出失败,"+a.resultMessage)})}),$(".toggleBox").on("click",".send-h-gift",function(e){if(console.log(0),!UIF.handler.login)return void UIF.handler.loging();var a=$(".toggleBox .chat-tip-id").attr("tid");if(a==UIF.handler.userId)return void s.dialog("不能自我增送礼物!");if(0==UIF.handler.newSendGiftID)return void s.dialog("请在礼物栏中选择要送出的礼物!");var n=$.trim($("#sendGiftNum").val());if(n<=0||!$.isNumeric(n))return void s.dialog("请正确填写礼物数量");var t=$(".toggleBox .chat-tip-name").text(),r=$("#gift"+UIF.handler.newSendGiftID+" >span").text();s.dialog("赠送"+t+n+r,function(e){UIF.handler.sendUserGift({toUser:a,giftId:UIF.handler.newSendGiftID,number:n},function(e){s.dialog("赠送成功!")})},function(e){})}),$(".son_ul li").on("click",function(){UIF.handler.sendTsg=this.id,$("#dstUserV").html($(this).text()),$(".switchChat").html($(this).text()),$(".changeCh").css("background",$(this).css("background")),$(".son_ul").hide()}),$(".cfchange").click(function(){return $(".son_ul").show(),$(".switchChat").html("　"),!1}),$(".chat-header .chat_right").click(function(){$(".chat-header .chat_right").removeClass("issel"),$(this).addClass("issel");var e=$(this).attr("ct"),a=e.charAt(e.length-1,1);$(".chat-header").siblings("div").hide(),$(".ui-resizable-handle").show(),$(".chs"+a).show()}),this.getCacheChat(UIF.handler.roomNumber)},spimg:function(e){var a="";if(null!=e&&e.length>0)for(var n=0;n<e.length;n++){var t=e[n];if(null!=t&&""!=t&&t.indexOf("pic_consumelevel")>0){a=t;break}}return a},headimg:function(e){var a="";if(null!=e&&""!=e&&e.length>0){var n='<span class="{0}"></span>',t=jQuery.parseJSON(e);if(null!=t&&t.length>0)for(var r=0;r<t.length;r++){var i=t[r];null!=i&&""!=i&&(a+=s.stringFormat(n,i))}}return a},pclass:function(e){var a="";if(null!=e&&e.length>0){var n=jQuery.parseJSON(e);if(null!=n&&n.length>0)for(var t=0;t<n.length;t++){var s=n[t];if(null!=s&&""!=s){if(s.indexOf("pic_consumelevel")>0){var r="",i=s.split("_consumelevel_");i[1]<10?r=" jv1":i[1]>10&&i[1]<21?r=" jv2":i[1]>20&&(r=" jv2"),a+=r}if(s.indexOf("pic_liverlevel")>0&&(a+=" anc"),s.indexOf("pic_guanli")>0&&(a+=" gl"),s.indexOf("pic_guardlevel")>0){var l="",i=s.split("pic_guardlevel_S_");i[1]<6?l=" gd1":i[1]>5&&i[1]<11?l=" gd2":i[1]>10&&(l=" gd2"),a+=l}}}}return a},getCacheChat:function(e){var a=this,n={roomNumber:e};$.ajax({type:"POST",url:"/ajax/getChatMessage.php",data:n,cache:!1,dataType:"json",async:!1}).done(function(e){$.each(e,function(e,n){var t='<li class="fontred"><span class="gr-time">{0}</span>{1}<a href="javascript:;" class="u{2}" rel="{3} {4} {5}">{6}</a>{7}</li>';words=r.faceReplaceImg(n.message);try{n.levs=n.levs.replace(/\\/g,"")}catch(e){n.levs=""}t=s.stringFormat(t,n.ctime,a.headimg(n.levs),a.pclass(n.levs),n.userId,decodeURIComponent(n.nickname),a.spimg(n.levs),decodeURIComponent(n.nickname)+"：",words),$("#pubChatList").append(t);try{$("#nano-pubChatList").nanoScroller(),$("#nano-pubChatList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}})})},visitors:function(e){if(null!=e.nickname){var a='<li class="fontred"><span>欢迎   </span><span class="u">{0} </span><span>进入房间</span></li>';a=s.stringFormat(a,decodeURIComponent(e.nickname)),$("#pubChatList").append(a);try{$("#nano-pubChatList").nanoScroller(),$("#nano-pubChatList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}}},welcome:function(e){if(null!=e.userId&&null!=e.nickname){if(null!=e.numbers&&$(".live-info .s-else .s-people").text(e.numbers),null!=e.himage)var a=e.himage;var n='<li class="fontred"><span>欢迎   </span>{0}<a href="javascript:;" class="u{1}" rel="{2} {3} {4}" data-img="{5}">{6}</a><span>进入房间</span></li>';n=s.stringFormat(n,this.headimg(e.levs),this.pclass(e.levs),e.userId,decodeURIComponent(e.nickname),this.spimg(e.levs),a,decodeURIComponent(e.nickname)),$("#pubChatList").append(n);try{$("#nano-pubChatList").nanoScroller(),$("#nano-pubChatList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}}},onAllMsg:function(e){1==UIF.thisHome&&(e.ctime=s.dateFormat(new Date,"HH:mm"),$.ajax({type:"POST",url:"/ajax/postChatMessage.php",data:e,cache:!1,dataType:"json",async:!1}).done(function(a){UIF.handler.weblog(e)}));var a='<li class="fontred"><span class="gr-time">'+s.dateFormat(new Date,"HH:mm")+'  </span>{0}<a href="javascript:;" class="u{1}" rel="{2} {3} {4}">{5}</a>{6}</li>';words=r.faceReplaceImg(e.message),a=s.stringFormat(a,this.headimg(e.levs),this.pclass(e.levs),e.userId,decodeURIComponent(e.nickname),this.spimg(e.levs),decodeURIComponent(e.nickname)+"：",words),$("#pubChatList").append(a);try{$("#nano-pubChatList").nanoScroller(),$("#nano-pubChatList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}},onPrvMsg:function(e){var a='<li class="fontred"><span class="gr-time">'+s.dateFormat(new Date,"HH:mm")+'  </span>{0}<a href="javascript:;" class="u{1}" rel="{2} {3} {4}">{5}</a><span class="prwords">{6}：{7}</span></li>',n=UIF.handler.cache.get(t.USER_HEADINFOS),i=s.stringFormat("{0}",null!=n&&n.userId==e.userId?"":"对你说");words=r.faceReplaceImg(e.message),a=s.stringFormat(a,this.headimg(e.levs),this.pclass(e.levs),e.userId,decodeURIComponent(e.nickname),this.spimg(e.levs),decodeURIComponent(e.nickname),i,words),$("#priChatList").append(a);try{$("#nano-priChatList").nanoScroller(),$("#nano-priChatList").nanoScroller({scroll:"bottom"})}catch(e){UIF.handler.weblog(e)}},onP2PMsg:function(e){var a='<li class="fontred"><span class="gr-time">'+s.dateFormat(new Date,"HH:mm")+"  </span>{0}<span>{1}{2}：{3}</span></li>",n=UIF.handler.cache.get(t.USER_HEADINFOS),i=s.stringFormat("{0}",null!=n&&n.userId==e.userId?"":"对你说");words=r.faceReplaceImg(e.message),words.indexOf(":")>0&&(words=words.substring(words.indexOf(":")+1,words.length)),a=s.stringFormat(a,this.headimg(e.levs),decodeURIComponent(e.nickname),i,words),$("#priChatList").append(a)},onNotice:function(e){var a='<div class="roomIntro"><span class="gr-time">公告：{0}</span></div>',n=null!=e&&null!=e.notice?e.notice:"";null!=n&&n.length>0&&$("#priChatList").append(s.stringFormat(a,n))},onFlyMsg:function(e){var a=e.nickname+"说："+e.message;i.fly(a)},runMsg:function(e){if("hornLi"==e.id){var a=e.userName+"说："+e.content;l.rwMsgH(s.dateFormat(new Date,"HH:mm"),{hornText:e.content,src_nickname:decodeURIComponent(e.userName)},r.replace_face(a))}else if("giftLi"==e.id){var a=e.userName+"在"+e.liverName+e.roomNumber+"的房间赠送了"+e.itemName+e.number;l.rwMsgGift(s.dateFormat(new Date,"HH:mm"),{src_nickname:decodeURIComponent(e.userName),anchorsName:decodeURIComponent(e.liverName),roomid:decodeURIComponent(e.roomNumber),giftId:e.itemName,number:e.number},r.replace_face(a))}else if("guardLi"==e.id){var a=e.userName+"在"+e.liverName+e.roomNumber+"的房间升级为"+e.consumeLevel;l.rwMsgG(s.dateFormat(new Date,"HH:mm"),{src_nickname:decodeURIComponent(e.userName),anchorsName:decodeURIComponent(e.liverName),roomid:decodeURIComponent(e.roomNumber),level:e.consumeLevel},r.replace_face(a))}else if("spenderLi"==e.id){var a="恭喜"+e.userName+"升级为"+e.consumeLevel;l.rwMsgS(s.dateFormat(new Date,"HH:mm"),{level:decodeURIComponent(e.consumeLevel),src_nickname:decodeURIComponent(e.userName)},r.replace_face(a))}else null==e.id&&console.log("there is no data")},banned:function(e){$("#sendChatBtn").attr("disabled",!0),$("#msgContent").attr("disabled",!0),s.dialog("你已被禁言！")},kickOut:function(e){self.location="/html/101.html"}}}),define("flyScreen",[],function(e,a,n){var t=e("anchor-tools"),s=e("anchor-face");n.exports={flyRoad:[0,0,0,0,0,0,0,0],fly:function(e){for(var a=this,n=["#fff","#f00","#0f0","#0ff"],r=t.rand(0,n.length),i=$('<marquee loop=1 scrollAmount=6 behavior="scroll" class="flyScreen"><table class="flycn"><tr><td style="color:'+n[r]+'">'+s.replace_face(e)+"</td></tr></table></marquee>"),l=0,o=!0,c=0;c<8;c++)if(0==a.flyRoad[c]){a.flyRoad[c]=1,l=c,o=!1;break}o&&(l=parseInt(8*Math.random()),a.flyRoad[l]=1);var d=50*l+60;i.css("top",d),$("body").append(i);var h=$(window).width()+i.children(".flycn").width(),r=h/.065,u=UIF.handler.ie6?r-1e4:r;setTimeout(function(){i.remove(),a.flyRoad[l]=0},u)}}}),define("toproom",[],function(e,a,n){e("anchor-face");n.exports={rwMsgH:function(e,a,n){var t=$('<li id="hornLi"><div><label><span class="rwUser">'+a.src_nickname+' : </span><span class="chatContent">'+a.hornText+"</span></label></div></li>"),s=$("#ulid"),r=$(".list_top");s.append(t),r.slideDown(),$("#ulid li").length>1&&s.children("li").first().remove(),setTimeout(function(){$("#ulid li").remove(),$(".list_top").slideUp()},105e3)},rwMsgS:function(e,a,n){var t=$('<li id="spenderLi"><div><label>恭喜 <span class="rwUser">'+a.src_nickname+' </span>升级为 <span class="upTit">'+a.level+"</span></label></div></li>"),s=$("#ulid"),r=$(".list_top");s.append(t),r.slideDown(),$("#ulid li").length>1&&s.children("li").first().remove(),setTimeout(function(){$("#ulid li").remove(),$(".list_top").slideUp()},105e3)},rwMsgG:function(e,a,n){var t=$('<li id="guardLi"><div><label><span class="rwUser">'+a.src_nickname+' </span> 在 <a href="/'+a.roomid+'" target="_blank" class="anchor">'+a.anchorsName+'</a> 的房间升级为 <span class="upTit">'+a.level+"</span></label></div></li>"),s=$("#ulid"),r=$(".list_top");s.append(t),r.slideDown(),$("#ulid li").length>1&&s.children("li").first().remove(),setTimeout(function(){$("#ulid li").remove(),$(".list_top").slideUp()},105e3)},rwMsgGift:function(e,a,n){var t=$('<li id="giftLi"><div><label><span class="rwUser">'+a.src_nickname+' </span> 在 <a href="/'+a.roomid+'" target="_blank" class="anchor">'+a.anchorsName+'</a> 的房间赠送了 <span class="gifts">'+a.giftId+" x"+a.number+"</span></label></a></li>"),s=$("#ulid"),r=$(".list_top");s.append(t),r.slideDown(),$("#ulid li").length>1&&s.children("li").first().remove(),setTimeout(function(){$("#ulid li").remove(),$(".list_top").slideUp()},105e3)},formatLuckNum:function(e){return+e?'<span class="fluck">('+e+")</span>":""}}});